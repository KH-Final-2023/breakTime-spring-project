<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="notice-mapper">

	<!-- 게시글 목록용 resultMap -->
	<resultMap type="notice" id="noticeResultSet">
		<result column="NOTICE_NO" property="noticeNo" />
		<result column="NOTICE_TITLE" property="noticeTitle" />
		<result column="USER_NO" property="userNo" />
		<result column="NOTICE_WRITER" property="noticeWriter" />
		<result column="USER_NAME" property="userName" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="COUNT" property="count" />
	</resultMap>

	<!-- 게시글 상세 조회용 resultMap -->
	<resultMap type="notice" id="noticeDetailResultSet">
		<result column="NOTICE_NO" property="noticeNo" />
		<result column="NOTICE_TITLE" property="noticeTitle" />
		<result column="NOTICE_CONTENT" property="noticeContent" />
		<result column="NOTICE_WRITER" property="noticeWriter" />
		<result column="USER_NAME" property="userName" />
		<result column="NOTICE_WRITER" property="noticeWriter" />
	</resultMap>



	<select id="selectNoticeListCount" resultType="_int">
		SELECT COUNT(*) FROM NOTICE
		WHERE STATUS = 'Y'
	</select>

	<select id="selectNoticeList" resultMap="noticeResultSet">
		SELECT
		NOTICE_NO,
		NOTICE_TITLE,
		NOTICE_WRITER,
		
		USER_NAME,
		N.CREATE_DATE,
		COUNT
		FROM NOTICE N
		JOIN MEMBER  ON USER_NO = NOTICE_WRITER
		WHERE N.STATUS = 'Y'
		ORDER BY N.CREATE_DATE DESC
	</select>


	<select id="selectNoticeDetail"
		resultMap="noticeDetailResultSet">
		SELECT 
		NOTICE_NO,
		NOTICE_WRITER,
		USER_NAME,
		NOTICE_TITLE,
		NOTICE_CONTENT
		FROM NOTICE N
		JOIN MEMBER M ON M.USER_NO = N.NOTICE_WRITER
		WHERE NOTICE_NO = #{noticeNo}
	</select>



	<insert id="insertNotice" useGeneratedKeys="true"
		parameterType="notice">

		<selectKey keyProperty="noticeNo" resultType="_int"
			order="BEFORE">
			SELECT SEQ_NNO.NEXTVAL FROM DUAL
		</selectKey>

		INSERT INTO NOTICE(
		NOTICE_NO,
		NOTICE_TITLE,
		NOTICE_WRITER,
		NOTICE_CONTENT
		) VALUES (
		#{noticeNo},
		#{noticeTitle},
		1,
		#{noticeContent}
		)

	</insert>

	<update id="updateNotice" parameterType="notice">
		UPDATE NOTICE SET
		NOTICE_TITLE = #{noticeTitle},
		NOTICE_CONTENT = #{noticeContent}
		WHERE NOTICE_NO = #{noticeNo}
	</update>

	<delete id="deleteNotice">
		DELETE FROM 
		NOTICE
		WHERE NOTICE_NO = #{noticeNo}
	</delete>
	
	<update id="updateReadCount">
	UPDATE NOTICE SET
	COUNT = COUNT +1
	WHERE NOTICE_NO = #{noticeNo}
	</update>
	
	<select id="searchNoticeListCount" resultType="_int">
	SELECT COUNT(*)
	FROM NOTICE N
	LEFT JOIN MEMBER M ON (NOTICE_WRITER = USER_NO)
	WHERE N.STATUS = 'Y'
	
	<if test='keyword != null and keyword != ""'>
		AND 
		<choose>
			<when test='condition == "title"'>
				NOTICE_TITLE LIKE CONCAT(CONCAT('%',#{keyword}),'%')
			</when>
			<when test='condition == "content"'>
				NOTICE_CONTENT LIKE '%${keyword}%'
			</when>			
			<when test='condition == "titleAndContent"'>
				(
					BOARD_TITLE LIKE CONCAT(CONCAT('%',#{keyword}),'%') 
					OR
					BOARD_CONTENT LIKE '%${keyword}%'
				)
			</when>			
		</choose>	
	</if>	
	</select>
	
	<select id="searchNoticeList" resultMap="noticeResultSet">
	SELECT
		NOTICE_NO,
		NOTICE_TITLE,
		NOTICE_WRITER,
		
		USER_NAME,
		COUNT,
		N.CREATE_DATE
	FROM NOTICE N
	LEFT JOIN MEMBER ON USER_NO = NOTICE_WRITER
	WHERE N.STATUS = 'Y' 
	<if test='keyword != null and keyword != ""'>
		AND 
		<choose>
			<when test='condition == "title"'>
				NOTICE_TITLE LIKE CONCAT(CONCAT('%',#{keyword}),'%')
			</when>
			<when test='condition == "content"'>
				NOTICE_CONTENT LIKE '%${keyword}%'
			</when>			
			<when test='condition == "titleAndContent"'>
				(
					NOTICE_TITLE LIKE CONCAT(CONCAT('%',#{keyword}),'%') 
					OR
					NOTICE_CONTENT LIKE '%${keyword}%'
				)
			</when>			
		</choose>	
	</if>
	ORDER BY N.CREATE_DATE DESC
	</select>
	
</mapper>
