<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="buRoom-mapper">
	
	<resultMap type="room" id="roomResultMap">
		<id column="ROOM_NO" property="roomNo" />
		<result column="BU_ID" property="buId" />
		<result column="ROOM_COUNT" property="roomCount" />
		<result column="ROOM_NAME" property="roomName" />
		<result column="ROOM_PRICE" property="roomPrice" />
		<result column="ROOM_INFO" property="roomInfo" />
	</resultMap>

	<resultMap type="roomImg" id="roomImgResultMap">
		<id column="FILE_NO" property="fileNo" />
		<result column="ORIGIN_NAME" property="originName" />
		<result column="SAVE_NAME" property="saveName" />
		<result column="FILE_PATH" property="filePath" />
		<result column="FILE_LEVEL" property="fileLevel" />
		<result column="STATUS" property="status" />
	</resultMap>
	<insert id="insertBuRoom" parameterType="room">
		<selectKey keyProperty="roomNo" resultType="int"
			order="BEFORE">
			SELECT SEQ_BNO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO ROOM
		(
		ROOM_NO,
		BU_ID,
		ROOM_COUNT,
		ROOM_NAME,
		ROOM_PRICE,
		ROOM_INFO
		)
		VALUES
		(
		#{roomNo},
		#{buId},
		#{roomCount},
		#{roomName},
		#{roomPrice},
		#{roomInfo}
		)
	</insert>

	<insert id="insertRoomImgList" parameterType="roomImg">
		INSERT INTO
		ROOM_IMG
		(
		FILE_NO,
		ROOM_NO,
		ORIGIN_NAME,
		SAVE_NAME,
		FILE_PATH,
		FILE_LEVEL,
		STATUS
		)
		VALUES
		(
		SEQ_FNO.NEXTVAL,
		#{roomNo},
		#{originName},
		#{saveName},
		#{filePath},
		#{fileLevel},
		#{status}
		)


	</insert>
	<update id="updateRoom">
		UPDATE ROOM SET
		ROOM_COUNT = #{roomCount},
		ROOM_NAME = #{roomName},
		ROOM_PRICE = #{roomPrice},
		ROOM_INFO = #{roomInfo}
		WHERE ROOM_NO = #{roomNo}
	</update>

	<update id="updateRoomImg">
		<!-- 반복문을 통해 roomImgList의 각 요소를 처리해야 할 수 있습니다. -->
		<foreach collection="list" item="roomImg" separator=";">
			UPDATE
			ROOM_IMG SET
			ORIGIN_NAME = #{originName},
			SAVE_NAME = #{saveName},
			FILE_PATH = #{filePath},
			FILE_LEVEL = #{fileLevel},
			STATUS = #{status}
			WHERE FILE_NO = #{fileNo}
		</foreach>
	</update>

<!-- 사업자의 방 목록 SELECT (준석) -->
<select id="getRoomsByBuId" parameterType="_int"
	resultMap="roomResultMap">
	SELECT *
	FROM ROOM
	WHERE ROOM_NO = #{roomNo}
</select>

<!-- 사업자의 방 이미지 목록 SELECT (준석) -->
<!-- 방 이미지 조회 -->
<select id="getRoomImagesByBuId" parameterType="_int"
	resultMap="roomImgResultMap">
	SELECT *
	FROM ROOM_IMG
	WHERE ROOM_NO = #{roomNo}
</select>

</mapper>
